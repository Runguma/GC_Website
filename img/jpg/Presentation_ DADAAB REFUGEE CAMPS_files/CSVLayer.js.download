// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.36/esri/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),function(g,h,e,n,p,f,k,l,m){return h(k,{declaredClass:"esri.layers.CSVLayer",_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",String:"esriFieldTypeString"},constructor:function(b,a){this.url=b;a=e.mixin({},a);this.columnDelimiter=a.columnDelimiter;this.latitudeFieldName=a.latitudeFieldName;this.longitudeFieldName=
a.longitudeFieldName;b=a.layerDefinition;b||(b={fields:a.fields||[],geometryType:"esriGeometryPoint",copyrightText:a.copyright},a.fields&&g.forEach(a.fields,function(c){c.type=this._fieldTypeMap[c.type||"String"];c.alias||(c.alias=c.name)},this));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,layerDefinition:b,outFields:a.outFields};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,
longitudeFieldName:this.longitudeFieldName});this._projectFeatures=e.hitch(this,this._projectFeatures);this._addFeatures=e.hitch(this,this._addFeatures);this._initCSVLayer(a)},refresh:function(){this._fireUpdateStart();this.applyEdits(null,null,this.graphics);this._loadFeatures()},_isWebGLCompatible:function(){return!1},_setMap:function(b){var a=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;
return a},_initCSVLayer:function(b){var a=this;f.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(c){!a._buildCsvFcParam.locationInfo||a.latitudeFieldName&&a.longitudeFieldName||(a.latitudeFieldName=a._buildCsvFcParam.locationInfo.latitudeFieldName,a.longitudeFieldName=a._buildCsvFcParam.locationInfo.longitudeFieldName);a._csvFC=c;var d=c.layerDefinition;d.extent=a._getFCExtent(c);b.outFields||(b.outFields=["*"]);b.timeInfo&&(d.timeInfo=b.timeInfo);a._initFeatureLayer({layerDefinition:d},
b)}).otherwise(this._errorHandler)},_loadFeatures:function(){f.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(b){return f.projectFeatureCollection(b,this._map.spatialReference)},_addFeatures:function(b){b=new m(b.featureSet);this.applyEdits(b.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(b){if(b&&b.featureSet&&b.featureSet.features){b=b.featureSet.features;var a=b.length;
if(1<a){var c=b[0].geometry;var d=new l(c.x,c.y,c.x,c.y);for(--a;0<a;a--)c=b[a].geometry,d.xmin=Math.min(d.xmin,c.x),d.ymin=Math.min(d.ymin,c.y),d.xmax=Math.max(d.xmax,c.x),d.ymax=Math.max(d.ymax,c.y);0>=d.getWidth()&&0>=d.getHeight()&&(d=null)}}return d}})});